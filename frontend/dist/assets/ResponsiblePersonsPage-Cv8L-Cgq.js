import{r as a,g as n,j as e,T as R,B as x,h as $,F as L,M as q,I as h,a as f,o as B,d as i,f as M,S as V,p as D,P as K,q as N,m as o}from"./index-CSMAVB73.js";const{Title:A}=R,H=()=>{const[I,b]=a.useState([]),[w,j]=a.useState(!0),[S,k]=a.useState(0),[g,_]=a.useState(1),[T,r]=a.useState(!1),[m,c]=a.useState(null),[l]=n.useForm(),[v,y]=a.useState([]),d=async(s=g)=>{j(!0);const{data:t}=await i.get("/assets/responsible-persons/",{params:{page:s}});b(t.results),k(t.count),j(!1)},F=async()=>{try{const{data:s}=await i.get("/assets/locations/",{params:{page_size:1e3}});y(s.results)}catch{y([])}};a.useEffect(()=>{d(),F()},[]);const P=async s=>{var t;try{m?(await i.put(`/assets/responsible-persons/${m}/`,s),o.success("МВО оновлено")):(await i.post("/assets/responsible-persons/",s),o.success("МВО створено")),r(!1),l.resetFields(),c(null),d()}catch(u){const p=(t=u.response)==null?void 0:t.data,O=typeof p=="object"?Object.values(p).flat().join(", "):"Помилка збереження";o.error(O)}},C=s=>{c(s.id),l.setFieldsValue(s),r(!0)},z=async s=>{var t,u;try{await i.delete(`/assets/responsible-persons/${s}/`),o.success("МВО видалено"),d()}catch(p){o.error(((u=(t=p.response)==null?void 0:t.data)==null?void 0:u.detail)||"Помилка видалення")}},E=[{title:"ПІП",dataIndex:"full_name",key:"full_name",ellipsis:!0},{title:"ІПН",dataIndex:"ipn",key:"ipn",width:120},{title:"Посада",dataIndex:"position",key:"position",ellipsis:!0},{title:"Місцезнаходження",dataIndex:"location_name",key:"location_name",ellipsis:!0},{title:"К-ть ОЗ",dataIndex:"assets_count",key:"assets_count",width:100},{title:"Статус",dataIndex:"is_active",key:"status",width:120,render:s=>e.jsx(M,{color:s?"green":"red",children:s?"Активна":"Неактивна"})},{title:"Дії",key:"actions",width:100,render:(s,t)=>e.jsxs(V,{size:"small",children:[e.jsx(x,{size:"small",icon:e.jsx(D,{}),onClick:()=>C(t)}),e.jsx(K,{title:"Видалити МВО?",onConfirm:()=>z(t.id),children:e.jsx(x,{size:"small",icon:e.jsx(N,{}),danger:!0})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[e.jsx(A,{level:4,style:{margin:0},children:"Матеріально відповідальні особи"}),e.jsx(x,{type:"primary",icon:e.jsx($,{}),onClick:()=>{c(null),l.resetFields(),r(!0)},children:"Нова МВО"})]}),e.jsx(L,{dataSource:I,columns:E,rowKey:"id",loading:w,pagination:{current:g,total:S,pageSize:25,onChange:s=>{_(s),d(s)},showTotal:s=>`Всього: ${s}`},size:"small"}),e.jsx(q,{title:m?"Редагувати МВО":"Нова МВО",open:T,onCancel:()=>{r(!1),c(null)},onOk:()=>l.submit(),okText:"Зберегти",cancelText:"Скасувати",children:e.jsxs(n,{form:l,layout:"vertical",onFinish:P,initialValues:{is_active:!0},children:[e.jsx(n.Item,{name:"full_name",label:"ПІП",rules:[{required:!0,message:"Введіть ПІП"}],children:e.jsx(h,{})}),e.jsx(n.Item,{name:"ipn",label:"ІПН",rules:[{required:!0,message:"Введіть ІПН"}],children:e.jsx(h,{maxLength:10})}),e.jsx(n.Item,{name:"position",label:"Посада",children:e.jsx(h,{})}),e.jsx(n.Item,{name:"location",label:"Місцезнаходження",children:e.jsx(f,{allowClear:!0,placeholder:"Оберіть місцезнаходження",children:v.map(s=>e.jsx(f.Option,{value:s.id,children:s.name},s.id))})}),e.jsx(n.Item,{name:"is_active",label:"Активна",valuePropName:"checked",children:e.jsx(B,{})})]})})]})};export{H as default};
