import{r as s,g as a,d as c,j as e,T,B as D,h as w,F,M as z,a as d,S as x,D as E,I as r,i as P,e as q,f as C,m as j}from"./index-CSMAVB73.js";const{Title:O}=T,A=[{value:"capital",label:"Капітальний ремонт"},{value:"current",label:"Поточний ремонт"},{value:"modernization",label:"Модернізація"},{value:"reconstruction",label:"Реконструкція"}],R=()=>{const[y,h]=s.useState([]),[b,I]=s.useState([]),[v,m]=s.useState(!0),[g,f]=s.useState(0),[u,_]=s.useState(1),[S,l]=s.useState(!1),[i]=a.useForm(),o=async(t=u)=>{m(!0);const{data:n}=await c.get("/assets/improvements/",{params:{page:t}});h(n.results),f(n.count),m(!1)};s.useEffect(()=>{o(),c.get("/assets/items/",{params:{status:"active",page_size:1e3}}).then(t=>{I(t.data.results||t.data)})},[]);const k=async t=>{var n,p;try{await c.post("/assets/improvements/",{...t,date:t.date.format("YYYY-MM-DD")}),j.success("Поліпшення створено"),l(!1),i.resetFields(),o()}catch(Y){j.error(((p=(n=Y.response)==null?void 0:n.data)==null?void 0:p.detail)||"Помилка")}},M=[{title:"Дата",dataIndex:"date",key:"date",render:t=>q(t).format("DD.MM.YYYY")},{title:"ОЗ",dataIndex:"asset_name",key:"asset",ellipsis:!0},{title:"Інв.номер",dataIndex:"asset_inventory_number",key:"inv"},{title:"Тип",dataIndex:"improvement_type_display",key:"type"},{title:"Сума, грн",dataIndex:"amount",key:"amount",render:t=>Number(t).toLocaleString("uk-UA",{minimumFractionDigits:2})},{title:"Виконавець",dataIndex:"contractor",key:"contractor",ellipsis:!0},{title:"Збільшує вартість",dataIndex:"increases_value",key:"increases_value",render:t=>e.jsx(C,{color:t?"green":"red",children:t?"Так":"Ні"})},{title:"Рах.витрат",dataIndex:"expense_account",key:"expense_account"}];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[e.jsx(O,{level:4,style:{margin:0},children:"Поліпшення та ремонти ОЗ"}),e.jsx(D,{type:"primary",icon:e.jsx(w,{}),onClick:()=>l(!0),children:"Нове поліпшення"})]}),e.jsx(F,{dataSource:y,columns:M,rowKey:"id",loading:v,pagination:{current:u,total:g,pageSize:25,onChange:t=>{_(t),o(t)}},size:"small"}),e.jsx(z,{title:"Нове поліпшення ОЗ",open:S,onCancel:()=>l(!1),onOk:()=>i.submit(),okText:"Зберегти",cancelText:"Скасувати",children:e.jsxs(a,{form:i,layout:"vertical",onFinish:k,initialValues:{expense_account:"91"},children:[e.jsx(a.Item,{name:"asset",label:"Основний засіб",rules:[{required:!0}],children:e.jsx(d,{showSearch:!0,optionFilterProp:"label",placeholder:"Оберіть ОЗ",options:b.map(t=>({value:t.id,label:`${t.inventory_number} — ${t.name}`}))})}),e.jsx(a.Item,{name:"improvement_type",label:"Тип поліпшення",rules:[{required:!0}],children:e.jsx(d,{options:A})}),e.jsxs(x,{size:"large",children:[e.jsx(a.Item,{name:"date",label:"Дата",rules:[{required:!0}],children:e.jsx(E,{format:"DD.MM.YYYY"})}),e.jsx(a.Item,{name:"document_number",label:"Номер документа",children:e.jsx(r,{})})]}),e.jsx(a.Item,{name:"description",label:"Опис робіт",children:e.jsx(r.TextArea,{rows:2})}),e.jsx(a.Item,{name:"amount",label:"Сума, грн",rules:[{required:!0}],children:e.jsx(P,{min:.01,step:.01,style:{width:"100%"}})}),e.jsx(a.Item,{name:"contractor",label:"Виконавець",children:e.jsx(r,{})}),e.jsxs(x,{size:"large",children:[e.jsx(a.Item,{name:"increases_value",label:"Збільшує вартість",rules:[{required:!0}],children:e.jsx(d,{options:[{value:!0,label:"Так"},{value:!1,label:"Ні"}]})}),e.jsx(a.Item,{name:"expense_account",label:"Рахунок витрат",children:e.jsx(r,{})})]})]})})]})};export{R as default};
