import{r as a,g as u,j as s,T as C,B as x,h as z,F as E,M as P,I as $,o as L,d as m,f as O,S as R,p as B,s as M,P as q,q as V,m as i}from"./index-CSMAVB73.js";const{Title:D}=C,N=()=>{const[g,f]=a.useState([]),[y,h]=a.useState(!0),[w,I]=a.useState(0),[j,S]=a.useState(1),[_,o]=a.useState(!1),[p,l]=a.useState(null),[n]=u.useForm(),c=async(e=j)=>{h(!0);const{data:t}=await m.get("/assets/locations/",{params:{page:e}});f(t.results),I(t.count),h(!1)};a.useEffect(()=>{c()},[]);const b=async e=>{var t;try{p?(await m.put(`/assets/locations/${p}/`,e),i.success("Місцезнаходження оновлено")):(await m.post("/assets/locations/",e),i.success("Місцезнаходження створено")),o(!1),n.resetFields(),l(null),c()}catch(r){const d=(t=r.response)==null?void 0:t.data,F=typeof d=="object"?Object.values(d).flat().join(", "):"Помилка збереження";i.error(F)}},T=e=>{l(e.id),n.setFieldsValue(e),o(!0)},k=async e=>{var t,r;try{await m.delete(`/assets/locations/${e}/`),i.success("Місцезнаходження видалено"),c()}catch(d){i.error(((r=(t=d.response)==null?void 0:t.data)==null?void 0:r.detail)||"Помилка видалення")}},v=[{title:"Назва",dataIndex:"name",key:"name",ellipsis:!0},{title:"К-ть ОЗ",dataIndex:"assets_count",key:"assets_count",width:100},{title:"Статус",dataIndex:"is_active",key:"status",width:120,render:e=>s.jsx(O,{color:e?"green":"red",children:e?"Активна":"Неактивна"})},{title:"Дії",key:"actions",width:100,render:(e,t)=>s.jsxs(R,{size:"small",children:[s.jsx(x,{size:"small",icon:s.jsx(B,{}),onClick:()=>T(t)}),s.jsx(M,{title:t.assets_count&&t.assets_count>0?"Неможливо видалити: є прив'язані ОЗ":void 0,children:s.jsx(q,{title:"Видалити місцезнаходження?",onConfirm:()=>k(t.id),disabled:!!t.assets_count&&t.assets_count>0,children:s.jsx(x,{size:"small",icon:s.jsx(V,{}),danger:!0,disabled:!!t.assets_count&&t.assets_count>0})})})]})}];return s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[s.jsx(D,{level:4,style:{margin:0},children:"Місцезнаходження"}),s.jsx(x,{type:"primary",icon:s.jsx(z,{}),onClick:()=>{l(null),n.resetFields(),o(!0)},children:"Нове місцезнаходження"})]}),s.jsx(E,{dataSource:g,columns:v,rowKey:"id",loading:y,pagination:{current:j,total:w,pageSize:25,onChange:e=>{S(e),c(e)},showTotal:e=>`Всього: ${e}`},size:"small"}),s.jsx(P,{title:p?"Редагувати місцезнаходження":"Нове місцезнаходження",open:_,onCancel:()=>{o(!1),l(null)},onOk:()=>n.submit(),okText:"Зберегти",cancelText:"Скасувати",children:s.jsxs(u,{form:n,layout:"vertical",onFinish:b,initialValues:{is_active:!0},children:[s.jsx(u.Item,{name:"name",label:"Назва",rules:[{required:!0,message:"Введіть назву"}],children:s.jsx($,{})}),s.jsx(u.Item,{name:"is_active",label:"Активна",valuePropName:"checked",children:s.jsx(L,{})})]})})]})};export{N as default};
