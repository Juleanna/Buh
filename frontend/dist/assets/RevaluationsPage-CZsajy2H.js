import{r as s,i as n,e as d,j as t,T as w,B as M,k as T,F as D,M as F,a as R,S as z,D as C,I as p,l as P,g as q,h as A,s as x}from"./index-BsBZMgFX.js";const{Title:B}=w,O=()=>{const[y,h]=s.useState([]),[v,j]=s.useState([]),[_,u]=s.useState(!0),[g,b]=s.useState(0),[c,f]=s.useState(1),[k,l]=s.useState(!1),[o]=n.useForm(),i=async(e=c)=>{u(!0);const{data:a}=await d.get("/assets/revaluations/",{params:{page:e}});h(a.results),b(a.count),u(!1)};s.useEffect(()=>{i(),d.get("/assets/items/",{params:{status:"active",page_size:1e3}}).then(e=>{j(e.data.results||e.data)})},[]);const I=async e=>{var a,m;try{await d.post("/assets/revaluations/",{...e,date:e.date.format("YYYY-MM-DD")}),x.success("Переоцінку створено"),l(!1),o.resetFields(),i()}catch(Y){x.error(((m=(a=Y.response)==null?void 0:a.data)==null?void 0:m.detail)||"Помилка")}},r=e=>Number(e).toLocaleString("uk-UA",{minimumFractionDigits:2}),S=[{title:"Дата",dataIndex:"date",key:"date",render:e=>q(e).format("DD.MM.YYYY")},{title:"ОЗ",dataIndex:"asset_name",key:"asset",ellipsis:!0},{title:"Інв.номер",dataIndex:"asset_inventory_number",key:"inv"},{title:"Тип",dataIndex:"revaluation_type_display",key:"type",render:(e,a)=>t.jsx(A,{color:a.revaluation_type==="upward"?"green":"red",children:e})},{title:"Справедлива вартість",dataIndex:"fair_value",key:"fair_value",render:r},{title:"Сума переоцінки",dataIndex:"revaluation_amount",key:"revaluation_amount",render:r},{title:"Зал.вартість до",dataIndex:"old_book_value",key:"old_book_value",render:r},{title:"Зал.вартість після",dataIndex:"new_book_value",key:"new_book_value",render:r}];return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[t.jsx(B,{level:4,style:{margin:0},children:"Переоцінки основних засобів"}),t.jsx(M,{type:"primary",icon:t.jsx(T,{}),onClick:()=>l(!0),children:"Нова переоцінка"})]}),t.jsx(D,{dataSource:y,columns:S,rowKey:"id",loading:_,pagination:{current:c,total:g,pageSize:25,onChange:e=>{f(e),i(e)}},size:"small"}),t.jsx(F,{title:"Нова переоцінка ОЗ",open:k,onCancel:()=>l(!1),onOk:()=>o.submit(),okText:"Зберегти",cancelText:"Скасувати",children:t.jsxs(n,{form:o,layout:"vertical",onFinish:I,children:[t.jsx(n.Item,{name:"asset",label:"Основний засіб",rules:[{required:!0}],children:t.jsx(R,{showSearch:!0,optionFilterProp:"label",placeholder:"Оберіть ОЗ",options:v.map(e=>({value:e.id,label:`${e.inventory_number} — ${e.name}`}))})}),t.jsxs(z,{size:"large",children:[t.jsx(n.Item,{name:"date",label:"Дата переоцінки",rules:[{required:!0}],children:t.jsx(C,{format:"DD.MM.YYYY"})}),t.jsx(n.Item,{name:"document_number",label:"Номер документа",children:t.jsx(p,{})})]}),t.jsx(n.Item,{name:"fair_value",label:"Справедлива вартість, грн",rules:[{required:!0}],children:t.jsx(P,{min:.01,step:.01,style:{width:"100%"}})}),t.jsx(n.Item,{name:"notes",label:"Примітки",children:t.jsx(p.TextArea,{rows:2})})]})})]})};export{O as default};
