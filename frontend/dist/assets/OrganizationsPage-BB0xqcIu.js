import{r as n,i as a,j as e,T as _,B as j,k as C,F as E,M as P,I as i,o as $,e as x,h as M,S as R,p as q,P as B,q as L,s as r}from"./index-uRi5TBFQ.js";const{Title:V}=_,D=()=>{const[y,I]=n.useState([]),[f,p]=n.useState(!0),[b,k]=n.useState(0),[g,w]=n.useState(1),[z,o]=n.useState(!1),[h,c]=n.useState(null),[l]=a.useForm(),d=async(s=g)=>{p(!0);const{data:t}=await x.get("/assets/organizations/",{params:{page:s}});I(t.results),k(t.count),p(!1)};n.useEffect(()=>{d()},[]);const S=async s=>{var t;try{h?(await x.put(`/assets/organizations/${h}/`,s),r.success("Організацію оновлено")):(await x.post("/assets/organizations/",s),r.success("Організацію створено")),o(!1),l.resetFields(),c(null),d()}catch(u){const m=(t=u.response)==null?void 0:t.data,O=typeof m=="object"?Object.values(m).flat().join(", "):"Помилка збереження";r.error(O)}},T=s=>{c(s.id),l.setFieldsValue(s),o(!0)},F=async s=>{var t,u;try{await x.delete(`/assets/organizations/${s}/`),r.success("Організацію видалено"),d()}catch(m){r.error(((u=(t=m.response)==null?void 0:t.data)==null?void 0:u.detail)||"Помилка видалення")}},v=[{title:"Назва",dataIndex:"name",key:"name",ellipsis:!0},{title:"Коротка назва",dataIndex:"short_name",key:"short_name",ellipsis:!0},{title:"ЄДРПОУ",dataIndex:"edrpou",key:"edrpou",width:120},{title:"Директор",dataIndex:"director",key:"director",ellipsis:!0},{title:"Гол. бухгалтер",dataIndex:"accountant",key:"accountant",ellipsis:!0},{title:"Статус",dataIndex:"is_active",key:"status",width:120,render:s=>e.jsx(M,{color:s?"green":"red",children:s?"Активна":"Неактивна"})},{title:"Дії",key:"actions",width:100,render:(s,t)=>e.jsxs(R,{size:"small",children:[e.jsx(j,{size:"small",icon:e.jsx(q,{}),onClick:()=>T(t)}),e.jsx(B,{title:"Видалити організацію?",onConfirm:()=>F(t.id),children:e.jsx(j,{size:"small",icon:e.jsx(L,{}),danger:!0})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[e.jsx(V,{level:4,style:{margin:0},children:"Організації"}),e.jsx(j,{type:"primary",icon:e.jsx(C,{}),onClick:()=>{c(null),l.resetFields(),o(!0)},children:"Нова організація"})]}),e.jsx(E,{dataSource:y,columns:v,rowKey:"id",loading:f,pagination:{current:g,total:b,pageSize:25,onChange:s=>{w(s),d(s)},showTotal:s=>`Всього: ${s}`},size:"small"}),e.jsx(P,{title:h?"Редагувати організацію":"Нова організація",open:z,onCancel:()=>{o(!1),c(null)},onOk:()=>l.submit(),okText:"Зберегти",cancelText:"Скасувати",children:e.jsxs(a,{form:l,layout:"vertical",onFinish:S,initialValues:{is_active:!0},children:[e.jsx(a.Item,{name:"name",label:"Назва",rules:[{required:!0,message:"Введіть назву організації"}],children:e.jsx(i,{})}),e.jsx(a.Item,{name:"short_name",label:"Коротка назва",children:e.jsx(i,{})}),e.jsx(a.Item,{name:"edrpou",label:"ЄДРПОУ",rules:[{required:!0,message:"Введіть код ЄДРПОУ"}],children:e.jsx(i,{maxLength:10})}),e.jsx(a.Item,{name:"address",label:"Адреса",children:e.jsx(i.TextArea,{rows:2})}),e.jsx(a.Item,{name:"director",label:"Директор",children:e.jsx(i,{})}),e.jsx(a.Item,{name:"accountant",label:"Головний бухгалтер",children:e.jsx(i,{})}),e.jsx(a.Item,{name:"is_active",label:"Активна",valuePropName:"checked",children:e.jsx($,{})})]})})]})};export{D as default};
