import{r as s,g as n,d,j as a,T as w,B as M,h as T,F as D,M as F,a as R,S as z,D as C,I as p,i as P,e as q,f as A,m as x}from"./index-CSMAVB73.js";const{Title:B}=w,O=()=>{const[y,v]=s.useState([]),[h,j]=s.useState([]),[g,u]=s.useState(!0),[_,b]=s.useState(0),[c,f]=s.useState(1),[k,l]=s.useState(!1),[o]=n.useForm(),i=async(e=c)=>{u(!0);const{data:t}=await d.get("/assets/revaluations/",{params:{page:e}});v(t.results),b(t.count),u(!1)};s.useEffect(()=>{i(),d.get("/assets/items/",{params:{status:"active",page_size:1e3}}).then(e=>{j(e.data.results||e.data)})},[]);const I=async e=>{var t,m;try{await d.post("/assets/revaluations/",{...e,date:e.date.format("YYYY-MM-DD")}),x.success("Переоцінку створено"),l(!1),o.resetFields(),i()}catch(Y){x.error(((m=(t=Y.response)==null?void 0:t.data)==null?void 0:m.detail)||"Помилка")}},r=e=>Number(e).toLocaleString("uk-UA",{minimumFractionDigits:2}),S=[{title:"Дата",dataIndex:"date",key:"date",render:e=>q(e).format("DD.MM.YYYY")},{title:"ОЗ",dataIndex:"asset_name",key:"asset",ellipsis:!0},{title:"Інв.номер",dataIndex:"asset_inventory_number",key:"inv"},{title:"Тип",dataIndex:"revaluation_type_display",key:"type",render:(e,t)=>a.jsx(A,{color:t.revaluation_type==="upward"?"green":"red",children:e})},{title:"Справедлива вартість",dataIndex:"fair_value",key:"fair_value",render:r},{title:"Сума переоцінки",dataIndex:"revaluation_amount",key:"revaluation_amount",render:r},{title:"Зал.вартість до",dataIndex:"old_book_value",key:"old_book_value",render:r},{title:"Зал.вартість після",dataIndex:"new_book_value",key:"new_book_value",render:r}];return a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[a.jsx(B,{level:4,style:{margin:0},children:"Переоцінки основних засобів"}),a.jsx(M,{type:"primary",icon:a.jsx(T,{}),onClick:()=>l(!0),children:"Нова переоцінка"})]}),a.jsx(D,{dataSource:y,columns:S,rowKey:"id",loading:g,pagination:{current:c,total:_,pageSize:25,onChange:e=>{f(e),i(e)}},size:"small"}),a.jsx(F,{title:"Нова переоцінка ОЗ",open:k,onCancel:()=>l(!1),onOk:()=>o.submit(),okText:"Зберегти",cancelText:"Скасувати",children:a.jsxs(n,{form:o,layout:"vertical",onFinish:I,children:[a.jsx(n.Item,{name:"asset",label:"Основний засіб",rules:[{required:!0}],children:a.jsx(R,{showSearch:!0,optionFilterProp:"label",placeholder:"Оберіть ОЗ",options:h.map(e=>({value:e.id,label:`${e.inventory_number} — ${e.name}`}))})}),a.jsxs(z,{size:"large",children:[a.jsx(n.Item,{name:"date",label:"Дата переоцінки",rules:[{required:!0}],children:a.jsx(C,{format:"DD.MM.YYYY"})}),a.jsx(n.Item,{name:"document_number",label:"Номер документа",children:a.jsx(p,{})})]}),a.jsx(n.Item,{name:"fair_value",label:"Справедлива вартість, грн",rules:[{required:!0}],children:a.jsx(P,{min:.01,step:.01,style:{width:"100%"}})}),a.jsx(n.Item,{name:"notes",label:"Примітки",children:a.jsx(p.TextArea,{rows:2})})]})})]})};export{O as default};
